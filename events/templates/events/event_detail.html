{% extends "base.html" %}
{% load static %}
{% block title %}Djisco - {{ event.title }}{% endblock title %}
{% block content %}
    {% if event.ends_at < now %}
        <p><a href="{% url 'event_list' %}">Home</a>&nbsp;&gt;&nbsp;{{ event.title }}</p>
    {% else %}
        <p><a href="{% url 'event_list' %}">Home</a>&nbsp;&gt;&nbsp;{{ event.title }}</p>
    {% endif %}
    <article data-event-card class="layout__single">
        <h2>{{ event.title }}</h2>
        <hr>
        <h4>Date And Time</h4>

        {% if event.ends_at < now %}
            <p>{{ event.starts_at|timesince }} ago - {{ event.starts_at|date }}</p>
        {% else %}
            <time>{{ event.starts_at }} - {{ event.ends_at }}</time>
        {% endif %}

        <hr>
        <h4>Location</h4>
        <p>{{ event.location }}</p>

        <hr>
        {% if event.ends_at < now %}
            <h4>Attendance</h4>
            <p>{{ event.attendee_count }} people attended out of {{ event.maximum_attendees }} possible spaces</p>
        {% else %}
            <h4>Attendance</h4>
            <p data-attendance-description
               data-attendance-description-type="detail"
            >
                {% if event.has_user_rsvp %}
                    {{ event.attendee_count }} attendee{{ event.attendee_count|pluralize:"s" }} out of {{ event.maximum_attendees }} spaces filled - {{ event.remaining_spaces }} spaces left - you are attending
                {% else %}
                    {{ event.attendee_count }} attendee{{ event.attendee_count|pluralize:"s" }} out of {{ event.maximum_attendees }} spaces filled - {{ event.remaining_spaces }} spaces left
                {% endif %}
            </p>
        {% endif %}
        <hr>
        <h4>description</h4>
        <p class="rich-text">{{ event.description }}</p>
        <hr>
        <div class="detail_form_container">
            {% include "events/attendance.html" %}
            <p data-error class="error hidden" aria-live="polite"></p>
        </div>
        <div>
            {% if user.is_authenticated %}
                <hr>
            {% endif %}
            <div class="table-container">
                <table>
                    <caption class="sr-only">Contribution Requirements for this Event</caption>
                    <thead>
                        <tr>
                            <th scope="col">Contribution Item</th>
                            <th scope="col">Required</th>
                            <th scope="col">Pledged</th>
                            <th scope="col">Fulfilled</th>
                            <th scope="col">
                                <button aria-label="New contribution requirement" class="button button--border">New</button>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            {% for requirement in contribution_requirements %}
                                <td class="contribution-title">{{ requirement.title }}</td>
                                <td>{{ requirement.requirements_count }}</td>
                                <td>{{ requirement.commitments_count }}</td>
                                <td>
                                    {% if requirement.commitments_count >= requirement.requirements_count %}
                                        <p>Yes</p>
                                    {% else %}
                                        <p>No</p>
                                    {% endif %}
                                </td>
                                <td>
                                    <button aria-label="Edit your pledged contribution" class="button button--border">Edit</button>
                                </td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="5">
                                        <p class="empty-table-message">There is no contribution currently required for this event</p>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </article>

{% endblock content %}
{% block javascript %}
    <script src="{% static 'scripts/attendance-form.js' %}"></script>
{% endblock javascript %}
